como instalar o debian em btrfs

instalação do debian em btrfs (serviço de preguiçoso pela interface gráfica)

iniciar o boot e selecionar advanced options / expert install
configurações iniciais
particionar
criar partições
/efi     sda1   512MB
/        sda2   Restante do disco


(antes de instalar o sistema básico) para acessar o terminal do busybox
 CTRL + ALT + F2

subvolumes que serão criados:

@ → raiz (/)

@home → /home

(opcionais)

@log → /var/log

@cache → /var/cache/

@root → /root (para Timeshift)

@.snapshots → /.snapshots (para Snapper)

criando os subvolumes no terminal do busybox:

df -h
umount -rl /target
df -h

criar subvolumes:

mount -t btrfs /dev/sda2 /target
cd /target
ls
mv @rootfs @
ls
btrfs su cr @home
btrfs su cr @log
btrfs su cr @cache
btrfs su cr @root
btrfs su cr @.snapshots
ls -la
cd
umount -rl /target
df -h

montar os subvolumes:

mount -o subvol=@,ssd,defaults,noatime,discard=async,compress=zstd:3,space_cache=v2,autodefrag /dev/sda2 /target
mkdir -p /boot/efi
mount /dev/sda1 /target/boot/efi
df -h

mkdir -p /target/home
mkdir -p /target/var/log
mkdir -p /target/var/cache
mkdir -p /target/root
mkdir -p /target/.snapshots
ls -la /target
ls /target/var


mount -o subvol=@home,ssd,defaults,noatime,discard=async,compress=zstd:3,space_cache=v2,autodefrag /dev/sda2 /target/home
mount -o subvol=@log,ssd,defaults,noatime,discard=async,compress=zstd:3,space_cache=v2,autodefrag /dev/sda2 /target/var/log
mount -o subvol=@cache,ssd,defaults,noatime,discard=async,compress=zstd:3,space_cache=v2,autodefrag /dev/sda2 /target/var/cache
mount -o subvol=@root,ssd,defaults,noatime,discard=async,compress=zstd:3,space_cache=v2,autodefrag /dev/sda2 /target/root
mount -o subvol=@snapshots,ssd,defaults,noatime,discard=async,compress=zstd:3,space_cache=v2,autodefrag /dev/sda2 /target/.snapshots

editar o fstab
nano /target/etc/fstab
alt+6 ctrl+u para copiar as linhas


CTRL + ALT + F1  (para sair do busybox e voltar ao instalador)

selecionar a interface gráfica e instalar o sistema.
